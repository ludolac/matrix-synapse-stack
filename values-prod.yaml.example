# Production values example for Matrix Synapse Helm Chart
# Copy this file to values-prod.yaml and customize for your environment
# IMPORTANT: Never commit values-prod.yaml - it contains sensitive information!

# To use this file:
# 1. cp values-prod.yaml.example values-prod.yaml
# 2. Edit values-prod.yaml with your actual configuration
# 3. Generate secrets: ./scripts/generate-secrets.sh all
# 4. Install: helm install matrix-synapse . -n matrix -f values-prod.yaml

synapse:
  server:
    # REQUIRED: Your Matrix homeserver domain
    name: "matrix.example.com"

    # Registration settings
    registration:
      enabled: false  # Set to true to allow open registration
      requireEmail: true
      allowGuests: false

    # Admin user (created by post-install job)
    adminUser:
      enabled: true
      username: "admin"
      email: "admin@example.com"
      admin: true
      displayName: "Administrator"

    # Report stats to matrix.org (optional)
    reportStats: false

    # Media storage limits
    media:
      maxUploadSize: "100M"
      maxImagePixels: "64M"

    # Email configuration (optional but recommended)
    email:
      enabled: false  # Set to true to enable email
      smtpHost: "smtp.example.com"
      smtpPort: 587
      smtpUser: "matrix-noreply@example.com"
      smtpPass: ""  # Add your SMTP password
      requireTransportSecurity: true
      notifFrom: "Matrix <matrix@example.com>"
      appName: "My Matrix Server"

    # TURN server for VoIP (optional)
    turn:
      enabled: false  # Set to true if you have a TURN server
      uris:
        - "turn:turn.example.com:3478?transport=udp"
        - "turn:turn.example.com:3478?transport=tcp"
      sharedSecret: ""  # Add your TURN shared secret
      userLifetime: "1h"

  # Persistence for media storage
  persistence:
    enabled: true
    storageClassName: "standard"  # Change to your storage class (e.g., "longhorn")
    size: 10Gi
    accessMode: ReadWriteOnce

  # Resource limits
  resources:
    limits:
      cpu: 2000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 512Mi

# Element Web configuration
element:
  enabled: true

  config:
    # Must match synapse.server.name
    defaultServerName: "matrix.example.com"
    defaultServerUrl: "https://matrix.example.com"

    # Room directory servers
    roomDirectory:
      servers:
        - matrix.org

    # Branding (optional)
    branding:
      authHeaderLogoUrl: ""
      welcomeBackgroundUrl: ""
      customCssUrl: ""

# Ingress configuration
ingress:
  enabled: true
  className: "traefik"  # Change to your ingress class

  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"  # Change to your cert-manager issuer
    traefik.ingress.kubernetes.io/router.entrypoints: "websecure"
    traefik.ingress.kubernetes.io/router.tls: "true"

  # Synapse ingress
  synapse:
    host: "matrix.example.com"  # REQUIRED: Your Matrix domain
    tls:
      secretName: "matrix-synapse-tls"

  # Element Web ingress
  element:
    host: "element.example.com"  # REQUIRED: Your Element domain
    tls:
      secretName: "matrix-element-tls"

  # Federation (port 8448)
  federation:
    enabled: true

# PostgreSQL configuration
postgresql:
  enabled: true

  # Database settings
  database: "synapse_prod"
  username: "synapse"
  # Password is generated by scripts/generate-secrets.sh

  # Persistence
  persistence:
    enabled: true
    storageClassName: "standard"  # Change to your storage class
    size: 20Gi

  # Resource limits
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi

# Network policies (optional - for enhanced security)
networkPolicy:
  enabled: false  # Set to true to enable NetworkPolicies

  ingress:
    traefik:
      namespaceSelector:
        name: traefik  # Change to your ingress controller namespace

  egress:
    sso:
      namespaceSelector:
        kubernetes.io/metadata.name: authentif  # Change if using SSO
